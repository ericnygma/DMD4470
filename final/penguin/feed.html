<!DOCTYPE html>
<html>
<head>
  <link href="https://fonts.googleapis.com/css?family=Roboto:100,300,400,500,700,900" rel="stylesheet">
  <link href="https://cdn.jsdelivr.net/npm/@mdi/font@6.x/css/materialdesignicons.min.css" rel="stylesheet">
  <link href="https://cdn.jsdelivr.net/npm/vuetify@2.x/dist/vuetify.min.css" rel="stylesheet">
  <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-firestore.js"></script>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no, minimal-ui">
</head>
<body>
  <div id="app">
    <v-app id="inspire">
      <v-navigation-drawer
                  v-model="drawer"
                  app
                >
                  <!-- LEFT DRAW -->

                  <v-sheet
                  color="grey lighten-4"
                  class="pa-4"
                >
                  <v-avatar
                    class="mb-4"
                    color="grey darken-1"
                    size="64"
                  ></v-avatar>
          
                  <div>Eric Nygma</div>
                </v-sheet>
          
                <v-divider></v-divider>
          
                <v-list>
                  <v-list-item
                    v-for="[icon, text] in links"
                    :key="icon"
                    link
                  >
                    <v-list-item-icon>
                      <v-icon>{{ icon }}</v-icon>
                    </v-list-item-icon>
          
                    <v-list-item-content>
                      <v-list-item-title>{{ text }}</v-list-item-title>
                    </v-list-item-content>
                  </v-list-item>
                </v-list>
              </v-navigation-drawer>


                </v-navigation-drawer>
            
                <v-app-bar app height="72" clipped-right>
                  <v-app-bar-nav-icon @click="drawer = !drawer" color="primary"></v-app-bar-nav-icon>
            
                  <v-toolbar-title>Penguin</v-toolbar-title>
                  

                  <v-spacer></v-spacer>

                  <v-responsive max-width="230">
                    <v-text-field
                      dense
                      flat
                      hide-details
                      rounded
                      solo-inverted
                    ></v-text-field>
                  </v-responsive>

                </v-app-bar>


                
                <v-navigation-drawer
                  app
                  clipped
                  right
                >

                
    
      <!-- <v-list>
        <v-list-item
          v-for="n in 5"
          :key="n"
          link
        >
          <v-list-item-content>
            <v-list-item-title>Item {{ n }}</v-list-item-title>
          </v-list-item-content>
        </v-list-item>
      </v-list> -->
    </v-navigation-drawer>

      <v-main>
        <v-container>
          <div class="mb-10">
            <!-- ADD NEW MESSAGE TO FEED -->
            <v-card
            elevation="2"
         >
          <div>

          </div>
            <v-form>
              <v-container>
                <v-row align="center" class='mx-5'>
                  <v-avatar
                      v-model="feed.username"
                      class="ma-2"
                      color="primary"
                      size="62"
                    >
                  <!-- <img 
                  v-if="avatar"
                  alt="Avatar"
                  src="penguin.svg"
                  >
                  <v-icon 
                  v-else
                  :color=""
                  v-text="icon"
                  ></v-icon> -->
                  </v-avatar>
                  <v-col>
                    

                    <v-text-field
                      v-model="feed.content"
                      label="What's good?"
                      placeholder="What's Poppin?"
                      counter="225"
                      :rules="rules"
                    ></v-text-field>

                    <v-row class="my-2">
                      <v-btn icon class='mr-3'>
                        <v-icon color="primary">mdi-panorama-variant-outline</v-icon>
                      </v-btn>
                      <v-btn icon class='mx-3'>
                        <v-icon color="primary">mdi-emoticon-outline</v-icon>
                      </v-btn>
                      <v-btn icon class='ml-3'>
                        <v-icon color="primary">mdi-calendar-clock-outline</v-icon>
                      </v-btn>
                    </v-row>
                    
                    
                    
                    
              
                  </v-col>
      
        <v-btn 
        icon
        large
        @click="addfeed()"
      >
      <v-icon color="primary">mdi-send</v-icon>
      </v-btn>
       </v-row>
      </v-container>
      </v-form>
     </v-card> 

          </div> 
                
            <!-- TWEETS FROM ALL USERS -->

            <v-card
            v-for="item in feeds" :key="item.id">
              <v-container>
                <v-card-title>
                  <v-row 
                  align="center"
                  justify="center"
                  class=""
                  >
                    <v-list-item class="grow">
                      <v-list-item-avatar size="56">
                        <img
                          alt="user"
                          src="https://cdn.pixabay.com/photo/2020/06/24/19/12/cabbage-5337431_1280.jpg"
                        >
                      </v-list-item-avatar>
                      <v-list-item-content>
                        
                          <v-list-item-title>
                            {{item.username}}
                            <v-list-item-action-text 
                            justify="end"
                            class="mx-6">{{item.published_date}} {{item.published_time}}</v-list-item-action-text>
                          </v-list-item-title>
                          
                          <!-- <v-list-item-subtitle>April,18 10:10am</v-list-item-subtitle> -->
  
                      </v-list-item-content>

                  </v-row>
                 </v-list-item>
               </v-card-title>
              <v-card-subtitle class="ml-16 px-7">{{item.content}}
              </v-card-subtitle>
  
                  
                  <!-- <v-spacer></v-spacer> -->
                <v-card-subtitle>
                  <v-card-actions>
                    
                    <v-row
                    align="center"
                    justify="center" 
                    class="px-2"
                    >
                    <v-btn icon class="mr-8">
                      <v-icon color="primary">
                        mdi-message-outline
                      </v-icon>
                    </v-btn>

                    <v-btn icon class="mr-0">
                      <v-icon color="primary">
                        mdi-repeat
                      </v-icon>
                    </v-btn>

                    <span class="subheading mr-8"></span>

                    <v-btn icon class="mr-0" 
                    @click="likePost(item.id)"
                    >
                      <v-icon class="mx-0" color="primary">
                        mdi-heart-outline
                      </v-icon>
                    </v-btn>

                    <span class="subheading mr-8">{{item.likes}}</span>

                    <v-btn icon class="ml-0" @click="deleteFeed(item.id)">
                      <v-icon color="primary">
                        mdi-delete-outline
                      </v-icon>

                    </v-btn>
                      
    
                                       
                 </v-row>
                    
  
                    
                    
  
                  </v-card-actions>
                </v-card-subtitle>
                  

              </v-container>
             
            </v-card>
                

              
          </v-container>
      </v-main>
    </v-app>
  </div>
  <script src="firebase.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/vue@2.x/dist/vue.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/vuetify@2.x/dist/vuetify.js"></script>
  <script>
    function showTime() {
    let today = new Date(),
       
        fd = today.toString();
    
    now.innerHTML = fd;
    setTimeout(showTime, 1000);

} 
  const d = new Date();
    // d.toLocaleDateString()
    const h = d.getHours();

    new Vue({
      el: '#app',
      vuetify: new Vuetify(),
      data(){
          return{
              hw:'Hello World',
              drawer:null,
              links: [
                ['mdi-android-messages', 'Home'],
                ['mdi-inbox-arrow-down', 'DM'],
                ['mdi-contacts-outline', 'Contact'],
                ['mdi-account-circle', 'Profile'],
                ],
              feed:{
                username:'Andy',
                avatar:'',
                content:'',
                media:'',
                likes:[],
                new:1,
                createdAt:'',
                publishedAt:''
              },
              feeds:[],
              rules: [
                value=> value.length <=225 || 'Max 225 characters',
            ],
                  
          }
          
          
      },
      methods: {
            addfeed() {
              db.collection('feeds').add ({
                username: this.feed.username,
                content: this.feed.content,
                createdAt: this.feed.createdAt,
                likes: this.feed.likes,
                publishedAt:firebase.firestore.FieldValue.serverTimestamp()
              })
              .then((docRef)=>{
                console.log("Document written with ID: " , docRef.id);
              })
              .catch((error)=>{
                console.log("Error adding document: ", error);
              })
              this.feed.content = ''
            },
            getFeedFromFirebase(){
              db.collection("feeds")
              .onSnapshot((querySnapshot)=>{
                  this.feeds = [];
                  console.log(this.feeds)
                  querySnapshot.forEach((doc)=>{
                      this.feeds.push({
                          username:doc.data().username,
                          content:doc.data().content,
                          likes:doc.data().likes.length,
                          publishedAt:doc.data().publishedAt,
                          published_date:doc.data().publishedAt.toDate().toLocaleDateString(),
                          published_time:doc.data().publishedAt.toDate().toLocaleTimeString(),
                          id:doc.id,
                      })
                      // console.log(doc.data().publishedAt)
                      // console.log(doc.data())
                      // console.log(doc.data().publishedAt),
                      // console.log(new Date(doc.data().publishedAt.seconds*1000)),
                      // console.log(doc.data().publishedAt.toDate().toLocaleDateString())
                      // console.log(doc.data().publishedAt.toDate().toLocaleTimeString())
                    })
                    
              })
          },
          deleteFeed(id){
            feeds.doc(id).delete()
            .then(()=>{
              console.log("Feed id: ", id," deleted successfully");
            })
            .catch((error)=>{
              console.error("Error deleting feed item: ", error);
            })
          },
    //       likePost(id){
            
    //   var docRef = db.collection("feeds").doc(docID);

    //   // Set the "capital" field of the city 'DC'

    //   //firebase.firestore.FieldValue.arrayUnion("joelsalisbury")

    //   return docRef
    //     .update({
    //       likes: firebase.firestore.FieldValue.arrayUnion("agardner"),
    //     })
    //     .then(() => {
    //       console.log("Document successfully updated!");
    //     })
    //     .catch((error) => {
    //       // The document probably doesn't exist.
    //       console.error("Error updating document: ", error);
    //     });
    // },
          
          
          },
          mounted() {
            this.getFeedFromFirebase();
          },
    })
  </script>
</body>
</html>
